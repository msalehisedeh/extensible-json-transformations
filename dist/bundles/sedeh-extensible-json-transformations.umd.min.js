!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@sedeh/extensible-json-transformations",["exports","@angular/core","@angular/common"],e):e(((t=t||self).sedeh=t.sedeh||{},t.sedeh["extensible-json-transformations"]={}),t.ng.core,t.ng.common)}(this,(function(t,e,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function r(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s}var n=function(){function t(t){this.path=t.split(".")}return t.prototype.fromLast=function(){return new t(this.path[this.path.length-1])},t.prototype.nodeOf=function(t){return this._nodeOf(t,this.path)},t.prototype._nodeOf=function(t,e){for(var o=t,r=0;r<this.path.length;r++){if(o instanceof Array){for(var n=[],i=0;i<this.path.length;i++){var s=o[i],a=this._nodeOf(s[e[r]],e.slice(r+1,e.length));a&&null!==a&&n.push(a)}n.length&&(o=n);break}o=o?o[e[r]]:o}return o},t.prototype.valueOf=function(t){return this._valueOf(t,this.path)},t.prototype._valueOf=function(t,e){for(var o=t,r=0;r<this.path.length;r++){if(o instanceof Array){for(var n=[],i=0;i<this.path.length;i++){var s=o[i];n.push(this._valueOf(s[e[r]],e.slice(r+1,e.length)))}o=n;break}o=e.length&&o?o[e[r]]:o}return o},t}(),i=function(){function t(){this.supportedMethods={},this.templates={},this.globalPool={},this.pathPool={},this.addSupportingMethod("valueOf",this.valueOf),this.addSupportingMethod("each",this.each),this.addSupportingMethod("split",this.split),this.addSupportingMethod("concat",this.concatenate),this.addSupportingMethod("enlist",this.enlist),this.addSupportingMethod("join",this.join),this.addSupportingMethod("filter",this.filter),this.addSupportingMethod("select",this.select),this.addSupportingMethod("style",this.style),this.addSupportingMethod("match",this.match),this.addSupportingMethod("apply",this.apply),this.addSupportingMethod("filter",this.filter),this.addSupportingMethod("select",this.select),this.addSupportingMethod("offPool",this.offPool)}return t.prototype.jXPathFor=function(t){var e=this.pathPool[t];return e||(e=new n(t),this.pathPool[t]=e),e},t.prototype.setRootNode=function(t){this.rootNode=this.nodeList(t),this.initPools(this.templates)},t.prototype.setContextNode=function(t){this.contextNode=t},t.prototype.templateForName=function(t){return this.templates[t]},t.prototype.nodeList=function(t){var e,o=null===t?this.rootNode:t;if(o instanceof Array)e=o;else{var r=Object.keys(o);e=[];for(var n=0;n<r.length;n++){var i=r[n];o[i]instanceof Array?e=e.concat(o[i]):e.push(o[i])}}return e},t.prototype.query=function(t,e){var o=this.toQueryOperation(t);if(e instanceof Array){for(var r=[],n=0;n<e.length;n++){var i=e[n];r=r.concat(this.invoke(o,i))}return r}return this.invoke(o,e)},t.prototype.invoke=function(t,e){var o=[];if("object"==typeof e&&e instanceof Array&&0===e.length)o=[];else if("object"==typeof t){var r=this.supportedMethods[t.name];if(r){if(t.args instanceof Array)for(var n=0;n<t.args.length;n++){var i=t.args[n];i.name?o.push(this.invoke(i,e)):o.push(i)}else o.push(t.args);var s=this.contextNode;this.contextNode=e,o=r.apply(this,o),this.contextNode=s}else o=t.name}else o=t;return o},t.prototype.concatenate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=t[0],r=t[1],n=t[2],i=[];if(o instanceof Array)if(n instanceof Array)if(o.length>n.length)for(var s=0;s<o.length;s++)i.push(o[s]+r+(n.length>s?n[s]:""));else for(s=0;s<n.length;s++)i.push((o.length>s?o[s]:"")+r+n[s]);else for(s=0;s<o.length;s++)i.push(o[s]+r+n);else if(n instanceof Array)for(s=0;s<n.length;s++)i.push(o+r+n[s]);else i.push(o+r+n);return i.length>1?i:i[0]},t.prototype.split=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[0]?t[0].split(t[1]):[]},t.prototype.valueOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.jXPathFor(t[0]);return o.valueOf(this.contextNode)},t.prototype.each=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=[],r={name:"valueOf",args:t[1]},n=0;n<t[0].length;n++){var i=t[0][n];o.push(this.invoke(r,i))}return o},t.prototype.enlist=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=[];return t.map((function(t){o.push(t)})),o},t.prototype.join=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[0].length>1?t[0].join(t[1]):t[0]},t.prototype.apply=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=this.jXPathFor(t[1]),r=o.fromLast(),n=t[2],i=[],s=0;s<this.rootNode.length;s++){var a=this.rootNode[s],h=o.nodeOf(a);if(h instanceof Array)for(var l=0;l<h.length;l++){var f=h[l],p=r.valueOf(f);this.evaluateOperation(p,"=",n)&&i.push(f)}else{p=r.valueOf(a);this.evaluateOperation(p,"=",n)&&i.push(a)}}return i.length&&(i=this.style(t[0],i)),i},t.prototype.match=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.templateForName(t[0]);if(!o)throw{message:"Missing Template definition for '"+t[0]+"'.",stack:(new Error).stack};var r=this.jXPathFor(t[1]),n=r.fromLast(),i=t[2],s=t[3],a=this.templateNodes(o,this.contextNode),h=[];if(a instanceof Array)for(var l=0;l<a.length;l++){var f,p=a[l];if((f=r.nodeOf(p))instanceof Array)for(var u=0;u<f.length;u++){var c=f[u],g=n.valueOf(c);this.evaluateOperation(g,i,s)&&h.push(c)}else{g=n.valueOf(p);this.evaluateOperation(g,i,s)&&h.push(p)}}else if((f=r.nodeOf(a))instanceof Array)for(u=0;u<f.length;u++){c=f[u],g=n.valueOf(c);this.evaluateOperation(g,i,s)&&h.push(c)}else{g=n.valueOf(a);this.evaluateOperation(g,i,s)&&h.push(a)}return h},t.prototype.filter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=this.jXPathFor(t[0]),r=t[1],n=t[2],i=[],s=0;s<this.contextNode.length;s++){var a=this.contextNode[s],h=o.valueOf(a);if(h instanceof Array)for(var l=0;l<h.length;l++){var f=h[l];this.evaluateOperation(f,r,n)&&i.push(a)}else this.evaluateOperation(h,r,n)&&i.push(a)}return i},t.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.jXPathFor(t[0]),r=[];if(this.contextNode instanceof Array)for(var n=0;n<this.contextNode.length;n++){var i,s=this.contextNode[n];(i=o.nodeOf(s))&&i.length&&r.push(s)}else(i=o.nodeOf(this.contextNode))&&i.length&&(i instanceof Array?r=i:r.push(i));return r},t.prototype.style=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.templateForName(t[0]);if(!o)throw{message:"Missing Template definition for '"+t[0]+"'.",stack:(new Error).stack};var r=[],n=Object.keys(o.style);if(t[1]instanceof Array)for(var i=0;i<t[1].length;i++){for(var s=t[1][i],a={},h=0;h<n.length;h++){a[l=n[h]]=this.invoke(o.style[l],s)}r.push(a)}else{for(a={},h=0;h<n.length;h++){var l;a[l=n[h]]=this.invoke(o.style[l],t[1])}r.push(a)}return r},t.prototype.addSupportingMethod=function(t,e){this.supportedMethods[t]=e},t.prototype.removeQuotes=function(t){return t.length&&"'"===t[0]&&"'"===t[t.length-1]?t.substring(1,t.length-1):t},t.prototype.toQueryOperation=function(t){var e=t.replace(/([^']+)|('[^']+')/g,(function(t,e,o){return e?e.replace(/\s/g,""):o})).replace(/'[^']+'/g,(function(t){return t.replace(/,/g,"~")}));return this.toFunctions(e)},t.prototype.toFunctions=function(t){for(var e=-1,o=-1,r=-1,n=0,i={},s=0;s<t.length;s++)if("("===t[s])0===n&&(e=s),n++;else if(")"===t[s]){if(0===--n)o=s,(a=i instanceof Array)||o!==t.length-1?(a||(i=[]),i.push({name:t.substring(r+1,e),args:this.toFunctions(t.substring(e+1,o))})):(i.name=t.substring(0,e),i.args=this.toFunctions(t.substring(e+1,o)))}else if(","===t[s])if(0===n&&s-1!==r){var a=i instanceof Array;if(r<0)e<0&&(a||(i=[]),i.push({name:this.removeQuotes(t.substring(r+1,s).replace(/~/g,",")),args:[]})),r=s;else{var h=this.removeQuotes(t.substring(r+1,s).replace(/~/g,","));h.indexOf("(")<0&&(i instanceof Array?i.push(h):i.args.push(h)),r=s}}else 0===n&&s-1===r&&(r=s);if(e>=0&&o<0)throw{message:"incorrect method call declaration. Missing ')'",stack:(new Error).stack};if(e<0&&o>0)throw{message:"incorrect method call declaration. Missing '('",stack:(new Error).stack};return e<0&&o<0&&r<0?t:(0===n&&r>o&&(i instanceof Array?i.push(this.removeQuotes(t.substring(r+1,t.length).replace(/~/g,","))):i.args.push(this.removeQuotes(t.substring(r+1,t.length).replace(/~/g,",")))),i)},t.prototype.templateNodes=function(t,e){var o=[],r=e;if("root"===t.context){if(!this.rootNode)throw{message:"Unable to find root node to perform operation.",stack:(new Error).stack};r=this.nodeList(this.rootNode)}if(t.match&&t.match.length)for(var n=this.jXPathFor(t.match),i=0;i<r.length;i++){var s=r[i];n.valueOf(s)===t.value&&o.push(s)}else e&&(o=r);return o},t.prototype.evaluateOperation=function(t,e,o){var r=!1;if(o instanceof Array){if("="===e){for(var n=0;n<o.length;n++)if(t==o[n]){r=!0;break}}else if("in"===e){for(n=0;n<o.length;n++)if(o[n].indexOf(t)>=0){r=!0;break}}else if("!"===e){var i=!1;for(n=0;n<o.length;n++)if(t==o[n]){i=!0;break}r=!i}}else"="===e?r=t==o:"in"===e?r=o.indexOf(t)>=0:"!"===e?r=t!==o:">"===e?r=parseFloat(t)>parseFloat(o):"<"===e&&(r=parseFloat(t)<parseFloat(o));return r},t.prototype.offPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=[],r=this.globalPool[t[0]],n=t[1];if(!r)throw{message:"Attempting to access pool '"+t[0]+"' that is not created.",stack:(new Error).stack};if(n instanceof Array)for(var i=0;i<n.length;i++){var s,a=n[i];(s=r[a])&&o.push(s)}else(s=r[n])&&o.push(s);return o},t.prototype.initTemplates=function(t){this.templates={};for(var e=0;e<t.length;e++){for(var o=t[e],r=Object.keys(o.style),n=0;n<r.length;n++){var i=r[n],s=o.style[i];"string"==typeof s&&(o.style[i]=this.toQueryOperation(s))}this.templates[o.name]=o}},t.prototype.initPools=function(t){var e=Object.keys(t);if(0===e.length)throw{message:"Missing Template definitions.",stack:(new Error).stack};if(!this.rootNode)throw{message:"Unable to find root node to perform operation.",stack:(new Error).stack};this.globalPool={};for(var o=0;o<e.length;o++){var r=e[o],n=this.templateForName(r);if(n.inPool){var i={},s=this.jXPathFor(n.inPool),a=n.match,h=this.rootNode;if(a&&n.value)for(var l=this.jXPathFor(a),f=0;f<h.length;f++){l.valueOf(h[f])===n.value&&(i[s.valueOf(h[f])]=h[f])}else for(f=0;f<h.length;f++)i[s.valueOf(h[f])]=h[f];this.globalPool[n.name]=i}}},t}(),s=function(){function t(t){this.inquirer=new i,this.transformations=t,this.inquirer.initTemplates(this.transformations.templates)}return t.prototype.changeRootNode=function(t){this.inquirer.setRootNode(t)},t.prototype.transform=function(){var t=[],e=this.inquirer.templateForName(this.transformations.rootTemplate);if(e)for(var o=Object.keys(e.style),r=this.inquirer.templateNodes(e,this.inquirer.nodeList(null)),n=0;n<r.length;n++){for(var i=r[n],s={},a=0;a<o.length;a++){var h=o[a];s[h]=this.inquirer.invoke(e.style[h],i)}t.push(s)}if(this.transformations.onResult&&this.transformations.onResult.length){var l=this.inquirer.toQueryOperation(this.transformations.onResult);t=this.inquirer.invoke(l,t)}return t},t}(),a=function(){function t(){this.node={},this.ontransformation=new e.EventEmitter,this.onerror=new e.EventEmitter}return t.prototype.ngOnInit=function(){if(this.node&&this.transformations){this.styler||(this.styler=new s(this.transformations)),this.styler.changeRootNode(this.node);try{this.ontransformation.emit(this.styler.transform())}catch(t){console.log(t),this.onerror.emit(t)}}},t.prototype.ngOnChanges=function(t){t.transformations?(this.styler=void 0,setTimeout(this.ngOnInit.bind(this),333)):t.node&&setTimeout(this.ngOnInit.bind(this),333)},r([e.Input("node")],t.prototype,"node",void 0),r([e.Input("transformations")],t.prototype,"transformations",void 0),r([e.Output("ontransformation")],t.prototype,"ontransformation",void 0),r([e.Output("onerror")],t.prototype,"onerror",void 0),t=r([e.Component({selector:"xjslt",template:""})],t)}(),h=function(){function t(){}return t=r([e.NgModule({imports:[o.CommonModule],declarations:[a],exports:[a],entryComponents:[a],providers:[],schemas:[e.CUSTOM_ELEMENTS_SCHEMA]})],t)}();t.Inquirer=i,t.JXPath=n,t.Styler=s,t.XjsltComponent=a,t.XjsltModule=h,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=sedeh-extensible-json-transformations.umd.min.js.map