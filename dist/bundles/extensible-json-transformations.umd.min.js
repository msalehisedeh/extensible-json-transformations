!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],e):e(t["extensible-json-transformations"]={},t.ng.core,t.ng.common)}(this,function(t,e,n){"use strict";var l=function(){function t(t){this.path=t.split(".")}return t.prototype.fromLast=function(){return new t(this.path[this.path.length-1])},t.prototype.nodeOf=function(t){return this._nodeOf(t,this.path)},t.prototype._nodeOf=function(t,r){for(var i=this,e=t,n=function(n){if(e instanceof Array){var o=[];return e.map(function(t){var e=i._nodeOf(t[r[n]],r.slice(n+1,r.length));e&&null!==e&&o.push(e)}),o.length&&(e=o),"break"}e=e?e[r[n]]:e},o=0;o<this.path.length;o++){if("break"===n(o))break}return e},t.prototype.valueOf=function(t){return this._valueOf(t,this.path)},t.prototype._valueOf=function(t,o){for(var r=this,i=t,e=function(e){if(i instanceof Array){var n=[];return i.map(function(t){n.push(r._valueOf(t[o[e]],o.slice(e+1,o.length)))}),i=n,"break"}i=o.length&&i?i[o[e]]:i},n=0;n<this.path.length;n++){if("break"===e(n))break}return i},t}(),o=function(){function t(){this.supportedMethods={},this.templates={},this.globalPool={},this.addSupportingMethod("valueOf",this.valueOf),this.addSupportingMethod("each",this.each),this.addSupportingMethod("split",this.split),this.addSupportingMethod("concat",this.concatenate),this.addSupportingMethod("enlist",this.enlist),this.addSupportingMethod("join",this.join),this.addSupportingMethod("filter",this.filter),this.addSupportingMethod("select",this.select),this.addSupportingMethod("style",this.style),this.addSupportingMethod("match",this.match),this.addSupportingMethod("apply",this.apply),this.addSupportingMethod("filter",this.filter),this.addSupportingMethod("select",this.select),this.addSupportingMethod("offPool",this.offPool)}return t.prototype.setRootNode=function(t){this.rootNode=t,this.initPools(this.templates)},t.prototype.templateForName=function(t){return this.templates[t]},t.prototype.nodeList=function(t){var e,n=null===t?this.rootNode:t;if(n instanceof Array)e=n;else{var o=Object.keys(n);e=[],o.map(function(t){n[t]instanceof Array?e=e.concat(n[t]):e.push(n[t])})}return e},t.prototype.query=function(t,e){var n=this,o=this.toQueryOperation(t);if(e instanceof Array){var r=[];return e.map(function(t){r=r.concat(n.invoke(o,t))}),r}return this.invoke(o,e)},t.prototype.invoke=function(t,e){var n=this,o=[];if("object"==typeof t){t.args instanceof Array?t.args.length&&t.args.map(function(t){t.name?o.push(n.invoke(t,e)):o.push(t)}):o.push(t.args),o.push(e);var r=this.supportedMethods[t.name];o=r?r.apply(this,o):t.name}else o=t;return o},t.prototype.concatenate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=t[0],r=t[1],i=t[2],a=[];return o instanceof Array?i instanceof Array?o.length>i.length?o.map(function(t,e){var n=i.length>e?i[e]:"";a.push(t+r+n)}):i.map(function(t,e){var n=o.length>e?o[e]:"";a.push(n+r+t)}):o.map(function(t){a.push(t+r+i)}):i instanceof Array?i.map(function(t){a.push(o+r+t)}):(a.push(o),a.push(r),a.push(i)),a.join("")},t.prototype.split=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[0]?t[0].split(t[1]):[]},t.prototype.valueOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new l(t[0]).valueOf(t[1])},t.prototype.each=function(){for(var n=this,o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];var r=[];return o[0].map(function(t){var e={name:"valueOf",args:o[1]};r.push(n.invoke(e,t))}),r},t.prototype.enlist=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[];return t.slice(0,t.length-1).map(function(t){n.push(t)}),n},t.prototype.join=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[0].join(t[1])},t.prototype.apply=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.match(t[0],t[1],"=",t[2],t[3])},t.prototype.match=function(){for(var o=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.templateForName(t[0]);if(!n)throw"Missing Template definition for '"+t[0]+"'.";var r=new l(t[1]),i=r.fromLast(),a=t[2],s=t[3],p=this.templateNodes(n,t[4]),u=[];if(p instanceof Array)p.map(function(t){var e=r.nodeOf(t);if(e instanceof Array)e.map(function(t){var e=i.valueOf(t);o.evaluateOperation(e,a,s)&&u.push(t)});else{var n=i.valueOf(t);o.evaluateOperation(n,a,s)&&u.push(t)}});else{var h=r.nodeOf(p);if(h instanceof Array)h.map(function(t){var e=i.valueOf(t);o.evaluateOperation(e,a,s)&&u.push(t)});else{var f=i.valueOf(p);this.evaluateOperation(f,a,s)&&u.push(p)}}return this.style(t[0],u)},t.prototype.filter=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=new l(t[0]),r=t[1],i=t[2],a=[];return t[3].map(function(e){var t=o.valueOf(e);t instanceof Array?t.map(function(t){n.evaluateOperation(t,r,i)&&a.push(e)}):n.evaluateOperation(t,r,i)&&a.push(e)}),a},t.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=new l(t[0]),o=[];if(t[1]instanceof Array)t[1].map(function(t){var e=n.nodeOf(t);e&&e.length&&o.push(t)});else{var r=n.nodeOf(t[1]);r&&r.length&&(r instanceof Array?o=r:o.push(r))}return o},t.prototype.style=function(){for(var o=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.templateForName(t[0]);if(!r)throw"Missing Template definition for '"+t[0]+"'.";var i=[],a=Object.keys(r.style);return t[1].map(function(e){var n={};a.map(function(t){n[t]=o.invoke(r.style[t],e)}),i.push(n)}),i},t.prototype.addSupportingMethod=function(t,e){this.supportedMethods[t]=e},t.prototype.removeQuotes=function(t){return t.length&&"'"===t[0]&&"'"===t[t.length-1]?t.substring(1,t.length-1):t},t.prototype.toQueryOperation=function(t){var e=t.replace(/([^']+)|('[^']+')/g,function(t,e,n){return e?e.replace(/\s/g,""):n}).replace(/'[^']+'/g,function(t){return t.replace(/,/g,"~")});return this.toFunctions(e)},t.prototype.toFunctions=function(t){for(var e=-1,n=-1,o=-1,r=0,i={},a=0;a<t.length;a++)if("("===t[a])0===r&&(e=a),r++;else if(")"===t[a]){if(0===--r)n=a,(s=i instanceof Array)||n!==t.length-1?(s||(i=[]),i.push({name:t.substring(o+1,e),args:this.toFunctions(t.substring(e+1,n))})):(i.name=t.substring(0,e),i.args=this.toFunctions(t.substring(e+1,n)))}else if(","===t[a])if(0===r&&a-1!==o){var s=i instanceof Array;if(o<0)e<0&&(s||(i=[]),i.push({name:this.removeQuotes(t.substring(o+1,a).replace(/~/g,",")),args:[]})),o=a;else{var p=this.removeQuotes(t.substring(o+1,a).replace(/~/g,","));p.indexOf("(")<0&&(i instanceof Array?i.push(p):i.args.push(p)),o=a}}else 0===r&&a-1===o&&(o=a);if(0<=e&&n<0)throw"incorrect method call declaration. Missing ')'";if(e<0&&0<n)throw"incorrect method call declaration. Missing '('";return e<0&&n<0&&o<0?t:(0===r&&n<o&&(i instanceof Array?i.push(this.removeQuotes(t.substring(o+1,t.length).replace(/~/g,","))):i.args.push(this.removeQuotes(t.substring(o+1,t.length).replace(/~/g,",")))),i)},t.prototype.templateNodes=function(e,t){var n=[],o=t;if("root"===e.context){if(!this.rootNode)throw"Unable to find root node to perform operation.";o=this.nodeList(this.rootNode)}if(e.match&&e.match.length){var r=new l(e.match);o.map(function(t){r.valueOf(t)===e.value&&n.push(t)})}else t&&(n=o);return n},t.prototype.evaluateOperation=function(e,t,n){var o=!1;if(n instanceof Array){if("="===t)n.map(function(t){e===t&&(o=!0)});else if("in"===t)n.map(function(t){0<=t.indexOf(e)&&(o=!0)});else if("!"===t){var r=!1;n.map(function(t){e===t&&(r=!0)}),o=!r}}else"="===t?o=e==n:"in"===t?o=0<=n.indexOf(e):"!"===t?o=e!==n:">"===t?o=parseFloat(e)>parseFloat(n):"<"===t&&(o=parseFloat(e)<parseFloat(n));return o},t.prototype.offPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[],o=this.globalPool[t[0]];if(!o)throw"Attempting to access pool '"+t[0]+"' that is not created.";if(t[1]instanceof Array)t[1].map(function(t){var e=o[t];e&&n.push(e)});else{var r=o[t[1]];r&&n.push(r)}return n},t.prototype.initTemplates=function(t){var n=this;t.map(function(e){Object.keys(e.style).map(function(t){e.style[t]=n.toQueryOperation(e.style[t])}),n.templates[e.name]=e})},t.prototype.initPools=function(t){var i=this,e=Object.keys(t);if(0===e.length)throw"Missing Template definitions.";if(!this.rootNode)throw"Unable to find root node to perform operation.";this.globalPool={},e.map(function(t){var e=i.templateForName(t);if(e.inPool){var n=new l(e.inPool),o=n.fromLast(),r=n.nodeOf(i.rootNode);i.globalPool[e.name]={},r instanceof Array?r.map(function(t){i.globalPool[e.name][o.valueOf(t)]=t}):i.globalPool[e.name][o.valueOf(r)]=r}})},t}(),r=function(){function t(t){this.inquirer=new o,this.transformations=t,this.inquirer.initTemplates(this.transformations.templates)}return t.prototype.changeRootNode=function(t){this.inquirer.setRootNode(t)},t.prototype.transform=function(){var o=this,t=[],r=this.inquirer.templateForName(this.transformations.rootTemplate);if(r){var e=this.inquirer.nodeList(null),i=Object.keys(r.style);e.map(function(e){var n={};i.map(function(t){n[t]=o.inquirer.invoke(r.style[t],e)}),t.push(n)})}if(this.transformations.onResult&&this.transformations.onResult.length){var n=this.inquirer.toQueryOperation(this.transformations.onResult);t=this.inquirer.invoke(n,t)}return t},t}(),i=function(){function t(){this.node={},this.ontransformation=new e.EventEmitter,this.onerror=new e.EventEmitter}return t.prototype.ngOnInit=function(){if(this.node&&this.transformations){this.styler||(this.styler=new r(this.transformations)),this.styler.changeRootNode(this.node);try{this.ontransformation.emit(this.styler.transform())}catch(t){this.onerror.emit(t.message)}}},t.prototype.ngOnChanges=function(t){t.transformations?(this.styler=undefined,setTimeout(this.ngOnInit.bind(this),333)):t.node&&setTimeout(this.ngOnInit.bind(this),333)},t}();i.decorators=[{type:e.Component,args:[{selector:"xjslt",template:"",styles:[]}]}],i.ctorParameters=function(){return[]},i.propDecorators={node:[{type:e.Input,args:["node"]}],transformations:[{type:e.Input,args:["transformations"]}],ontransformation:[{type:e.Output,args:["ontransformation"]}],onerror:[{type:e.Output,args:["onerror"]}]};var a=function(){};a.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],declarations:[i],exports:[i],entryComponents:[i],providers:[],schemas:[e.CUSTOM_ELEMENTS_SCHEMA]}]}],a.ctorParameters=function(){return[]},t.XjsltComponent=i,t.Styler=r,t.JXPath=l,t.Inquirer=o,t.XjsltModule=a,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=extensible-json-transformations.umd.min.js.map
