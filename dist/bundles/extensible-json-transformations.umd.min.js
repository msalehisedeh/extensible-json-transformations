!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],e):e(t["extensible-json-transformations"]={},t.ng.core,t.ng.common)}(this,function(t,e,n){"use strict";var l=function(){function t(t){this.path=t.split(".")}return t.prototype.fromLast=function(){return new t(this.path[this.path.length-1])},t.prototype.nodeOf=function(t){return this._nodeOf(t,this.path)},t.prototype._nodeOf=function(t,r){for(var s=this,e=t,n=function(n){if(e instanceof Array){var o=[];return e.map(function(t){var e=s._nodeOf(t[r[n]],r.slice(n+1,r.length));e&&null!==e&&o.push(e)}),o.length&&(e=o),"break"}e=e?e[r[n]]:e},o=0;o<this.path.length;o++){if("break"===n(o))break}return e},t.prototype.valueOf=function(t){return this._valueOf(t,this.path)},t.prototype._valueOf=function(t,o){for(var r=this,s=t,e=function(e){if(s instanceof Array){var n=[];return s.map(function(t){n.push(r._valueOf(t[o[e]],o.slice(e+1,o.length)))}),s=n,"break"}s=o.length&&s?s[o[e]]:s},n=0;n<this.path.length;n++){if("break"===e(n))break}return s},t}(),o=function(){function t(t){this.templates={},this.globalPool={},this.supportedMethods={},this.transformations=t,this.registerMethods(),this.prepareTransformations()}return t.prototype.changeRootNode=function(t){this.rootNode=t,this.globalPool={},this.preparePools()},t.prototype.transform=function(){var o=this,t=[],r=this.templates[this.transformations.rootTemplate];if(r){var e=this.rootNode instanceof Array?this.rootNode:Object.keys(this.rootNode),s=Object.keys(r.style);e.map(function(e){var n={};s.map(function(t){n[t]=o.execute(r.style[t],e)}),t.push(n)})}if(this.transformations.onResult&&this.transformations.onResult.length){var n=this.parseFunctions(this.transformations.onResult);t=this.execute(n,t)}return t},t.prototype.apply=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.match(t[0],t[1],"=",t[2],t[3])},t.prototype.execute=function(t,e){var n=this,o=[];if("object"==typeof t){t.args instanceof Array?t.args.length&&t.args.map(function(t){t.name?o.push(n.execute(t,e)):o.push(t)}):o.push(t.args),o.push(e);var r=this.supportedMethods[t.name];o=r?r.apply(this,o):t.name}else o=t;return o},t.prototype.concatenate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.slice(0,t.length-1).join("")},t.prototype.split=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[0].split(t[1])},t.prototype.valueOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new l(t[0]).valueOf(t[1])},t.prototype.each=function(){for(var n=this,o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];var r=[];return o[0].map(function(t){var e={name:"valueOf",args:o[1]};r.push(n.execute(e,t))}),r},t.prototype.enlist=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[];return t.slice(0,t.length-1).map(function(t){n.push(t)}),n},t.prototype.join=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[0].join(t[1])},t.prototype.evaluateOperation=function(e,t,n){var o=!1;if(n instanceof Array){if("="===t)n.map(function(t){e===t&&(o=!0)});else if("in"===t)n.map(function(t){0<=t.indexOf(e)&&(o=!0)});else if("!"===t){var r=!1;n.map(function(t){e===t&&(r=!0)}),o=!r}}else"="===t?o=e==n:"in"===t?o=0<=n.indexOf(e):"!"===t?o=e!==n:">"===t?o=parseFloat(e)>parseFloat(n):"<"===t&&(o=parseFloat(e)<parseFloat(n));return o},t.prototype.templateNodes=function(e,t){var n=[],o=this.rootNode instanceof Array?this.rootNode:Object.keys(this.rootNode);if(o="root"===e.context?o:t,e.match&&e.match.length){var r=new l(e.match);o.map(function(t){r.valueOf(t)===e.value&&n.push(t)})}else t&&(n=o);return n},t.prototype.match=function(){for(var o=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.templates[t[0]];if(!n)throw"Missing Template definition for '"+t[0]+"'.";var r=new l(t[1]),s=r.fromLast(),a=t[2],i=t[3],p=this.templateNodes(n,t[4]),u=[];if(p instanceof Array)p.map(function(t){var e=r.nodeOf(t);if(e instanceof Array)e.map(function(t){var e=s.valueOf(t);o.evaluateOperation(e,a,i)&&u.push(t)});else{var n=s.valueOf(t);o.evaluateOperation(n,a,i)&&u.push(t)}});else{var h=r.nodeOf(p);if(h instanceof Array)h.map(function(t){var e=s.valueOf(t);o.evaluateOperation(e,a,i)&&u.push(t)});else{var f=s.valueOf(p);this.evaluateOperation(f,a,i)&&u.push(p)}}return this.style(t[0],u)},t.prototype.filter=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=new l(t[0]),r=t[1],s=t[2],a=[];return t[3].map(function(e){var t=o.valueOf(e);t instanceof Array?t.map(function(t){n.evaluateOperation(t,r,s)&&a.push(e)}):n.evaluateOperation(t,r,s)&&a.push(e)}),a},t.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=new l(t[0]),o=[];if(t[1]instanceof Array)t[1].map(function(t){var e=n.nodeOf(t);e&&e.length&&o.push(t)});else{var r=n.nodeOf(t[1]);r&&r.length&&(r instanceof Array?o=r:o.push(r))}return o},t.prototype.style=function(){for(var o=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.templates[t[0]],s=[],a=Object.keys(r.style);return t[1].map(function(e){var n={};a.map(function(t){n[t]=o.execute(r.style[t],e)}),s.push(n)}),s},t.prototype.offPool=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[],o=this.globalPool[t[0]];if(!o)throw"Attempting to access pool '"+t[0]+"' that is not created.";if(t[1]instanceof Array)t[1].map(function(t){var e=o[t];e&&n.push(e)});else{var r=o[t[1]];r&&n.push(r)}return n},t.prototype.registerMethods=function(){this.supportedMethods.apply=this.apply,this.supportedMethods.valueOf=this.valueOf,this.supportedMethods.each=this.each,this.supportedMethods.split=this.split,this.supportedMethods.concat=this.concatenate,this.supportedMethods.enlist=this.enlist,this.supportedMethods.join=this.join,this.supportedMethods.match=this.match,this.supportedMethods.filter=this.filter,this.supportedMethods.select=this.select,this.supportedMethods.style=this.style,this.supportedMethods.offPool=this.offPool},t.prototype.prepareTransformations=function(){var n=this;this.transformations.templates.map(function(e){Object.keys(e.style).map(function(t){e.style[t]=n.parseFunctions(e.style[t])}),n.templates[e.name]=e})},t.prototype.preparePools=function(){var s=this;Object.keys(this.templates).map(function(t){var e=s.templates[t];if(e.inPool){var n=new l(e.inPool),o=n.fromLast(),r=n.nodeOf(s.rootNode);s.globalPool[e.name]={},r instanceof Array?r.map(function(t){s.globalPool[e.name][o.valueOf(t)]=t}):s.globalPool[e.name][o.valueOf(r)]=r}})},t.prototype.removeQuotes=function(t){return t.length&&"'"===t[0]&&"'"===t[t.length-1]?t.substring(1,t.length-1):t},t.prototype.parseFunctions=function(t){for(var e=-1,n=-1,o=-1,r=0,s={},a=0;a<t.length;a++)if("("===t[a])0===r&&(e=a),r++;else if(")"===t[a]){if(0===--r)n=a,(i=s instanceof Array)||n!==t.length-1?(i||(s=[]),s.push({name:t.substring(o+1,e),args:this.parseFunctions(t.substring(e+1,n))})):(s.name=t.substring(0,e),s.args=this.parseFunctions(t.substring(e+1,n)))}else if(","===t[a])if(0===r&&a-1!==o){var i=s instanceof Array;if(o<0)e<0&&(i||(s=[]),s.push({name:this.removeQuotes(t.substring(o+1,a)),args:[]})),o=a;else if(("'"===t[a-1]||" "===t[a-1]&&"'"===t[a-2])&&(a<t.length-1&&"'"===t[a+1]||a<t.length-2&&" "===t[a+1]&&"'"===t[a+2]))s instanceof Array?s.push(","):s.args.push(","),o=a+1;else{var p=t.substring(o+1,a);p.indexOf("'")<0&&(s instanceof Array?s.push(p):s.args.push(p)),o=a}}else 0===r&&a-1===o&&(o=a);if(0<=e&&n<0)throw"incorrect method call declaration. Missing ')'";if(e<0&&0<n)throw"incorrect method call declaration. Missing '('";return e<0&&n<0&&o<0?t:(0===r&&n<o&&(s instanceof Array?s.push(this.removeQuotes(t.substring(o+1,t.length).trim())):s.args.push(this.removeQuotes(t.substring(o+1,t.length).trim()))),s)},t}(),r=function(){function t(){this.node={},this.ontransformation=new e.EventEmitter}return t.prototype.ngOnInit=function(){this.node&&this.transformations&&(this.styler||(this.styler=new o(this.transformations)),this.styler.changeRootNode(this.node),this.ontransformation.emit(this.styler.transform()))},t.prototype.ngOnChanges=function(t){t.transformations?(this.styler=undefined,setTimeout(this.ngOnInit.bind(this),333)):t.node&&setTimeout(this.ngOnInit.bind(this),333)},t}();r.decorators=[{type:e.Component,args:[{selector:"xjslt",template:"",styles:[]}]}],r.ctorParameters=function(){return[]},r.propDecorators={node:[{type:e.Input,args:["node"]}],transformations:[{type:e.Input,args:["transformations"]}],ontransformation:[{type:e.Output,args:["ontransformation"]}]};var s=function(){};s.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],declarations:[r],exports:[r],entryComponents:[r],providers:[],schemas:[e.CUSTOM_ELEMENTS_SCHEMA]}]}],s.ctorParameters=function(){return[]},t.XjsltComponent=r,t.XjsltModule=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=extensible-json-transformations.umd.min.js.map
